swagger: "2.0"

info:
  title: JAWS (JGI Analysis Workflows Service)
  description: Definition of REST API for JGI Analysis Workflows Service
  version: "2.0"
consumes:
  - application/json
produces:
  - application/json
basePath: /api/v2

securityDefinitions:
  oauth2:
    type: oauth2
    flow: implicit
    authorizationUrl: http://localhost:8080/login
    x-tokenInfoUrl: http://localhost:8080/tokeninfo
    scopes:
      uid: Registered user with unique ID

security:
  - oauth2: ['jaws_users']

paths:

  /status:
    get:
      operationId: jaws_central.utils.status
      responses:
        200:
          description: OK
        500:
          description: System is down
      security: []

  /wdl:
    get:
      operationId: jaws_central.catalog.list_wdls
      tags:
        - workflow
      summary: List shared workflows
      description: List all available workflows
      responses:
        200:
          description: OK
          schema:
            type: array
            properties:
              id:
                type: integer
                description: Unique ID
              name:
                type: string
                description: Workflow name
              version:
                type: string
                description: Workflow version
        401:
          description: Authorization information is missing or invalid.

  /wdl/{name}:
    get:
      operationId: jaws_central.catalog.get_versions
      tags:
        - workflow
      summary: Workflow versions
      description: Returns a workflow's available versions
      parameters:
        - name: name
          in: path
          description: name of the workflow
          type: string
          required: True
      responses:
        200:
          description: OK
          schema:
            type: array
            properties:
              id:
                type: integer
                description: Unique ID
              name:
                type: string
                description: Workflow name
              version:
                type: string
                description: Workflow version
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

  /wdl/{name}/{version}:
    get:
      operationId: jaws_central.catalog.get_wdl
      tags:
        - workflow
      summary: Return a workflow's WDL file
      description: Returns the workflow specification in WDL or CWL format
      parameters:
        - name: name
          in: path
          description: name of the workflow
          type: string
          required: True
        - name: version
          in: path
          description: version of the workflow
          type: string
          required: True
      produces:
        - text/plain; charset=utf-8
      responses:
        200:
          description: OK
          schema:
            type: file
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

    post:
      operationId: jaws_central.catalog.add_wdl
      consumes:
        - multipart/form-data
      tags:
        - workflow
      summary: Add a workflow WDL
      description: Upload WDL
      parameters:
        - name: wdl_file
          in: formData
          type: file
          required: True
          description: WDL file
        - name: md_file
          in: formData
          type: file
          required: True
          description: Documentation file in markdown format
        - name: name
          in: path
          type: string
          required: True
          description: name of workflow
        - name: version
          in: path
          type: string
          required: True
          description: version of workflow
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.

    put:
      operationId: jaws_central.catalog.update_wdl
      tags:
        - workflow
      summary: Replace a workflow's WDL
      description: Upload WDL
      parameters:
        - name: name
          in: path
          type: string
          required: True
          description: name of workflow
        - name: version
          in: path
          type: string
          required: True
          description: version of workflow
        - name: wdl_file
          in: formData
          type: file
          required: False
          description: new WDL file
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified workflow does not exist.

    delete:
      operationId: jaws_central.catalog.del_wdl
      tags:
        - workflow
      summary: Delete a workflow
      description: Delete a specific version of a workflow
      parameters:
        - name: name
          in: path
          type: string
          required: True
          description: name of workflow
        - name: version
          in: path
          type: string
          required: True
          description: version of workflow
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified workflow does not exist.

  /wdl/{name}/{version}/doc:
    get:
      operationId: jaws_central.catalog.get_doc
      tags:
        - workflow
      summary: Return information about a workflow
      description: Returns the workflow's description
      parameters:
        - name: name
          in: path
          description: name of the workflow
          type: string
          required: True
        - name: version
          in: path
          description: version of the workflow
          type: string
          required: True
      produces:
        - text/html
      responses:
        200:
          description: OK
          schema:
            type: file
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

    put:
      operationId: jaws_central.catalog.update_doc
      tags:
        - workflow
      summary: Update a workflow's documentation
      description: Replaces the doc file for a workflow
      parameters:
        - name: name
          in: path
          description: name of the workflow
          type: string
          required: True
        - name: version
          in: path
          description: version of the workflow
          type: string
          required: True
        - name: md_file
          in: formData
          description: New doc file in markdown format
          type: file
          required: True
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

  /run:
    get:
      operationId: jaws_central.analysis.user_queue
      tags:
        - run
      summary: Search for current user's unfinished runs
      description: Return runs in Submitted, Queued, Running, or Transferring states.
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.

    post:
      operationId: jaws_central.analysis.submit_run
      consumes:
        - multipart/form-data
      tags:
        - run
      summary: Begin run run process
      description: Returns site information to send infiles.
      parameters:
        - name: site
          description: computing site to use
          type: string
          in: formData
          required: True
        - name: submission_uuid
          description: random ID used to name inputs
          type: string
          in: formData
          required: True
        - name: transfer_task_id
          description: Globus task id
          type: string
          in: formData
          required: True
        - name: globus_endpoint
          description: Globus endpoint to receive results
          type: string
          in: formData
          required: True
        - name: outdir
          description: Folder to receive results
          type: string
          in: formData
          required: True
      responses:
        201:
          description: Successful
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The requested site does not exist

  /run/{run_id}:
    get:
      operationId: jaws_central.analysis.run_status
      tags:
        - run
      summary: Retrieve the status of a specified run
      description: Summarize the state of a particular run
      parameters:
        - name: run_id
          in: path
          description: run_id of the run to retrieve
          type: integer
          required: True
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

    delete:
      operationId: jaws_central.analysis.cancel_run
      tags:
        - run
      summary: Cancel a run and purge it's output
      description: Purging prevents reuse by cache
      parameters:
        - name: run_id
          in: path
          type: integer
          required: True
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

  /run/{run_id}/metadata:
    get:
      operationId: jaws_central.analysis.run_metadata
      tags:
        - run
      summary: Retrieve the metadata of a specified run
      description: Return assorted information about a run
      parameters:
        - name: run_id
          in: path
          description: run_id of the run to retrieve
          type: integer
          required: True
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist

  /site:
    get:
      operationId: jaws_central.analysis.list_sites
      tags:
        - site
      summary: Retrieve summary of all JAWS-Sites
      description: List all Sites
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.

  /site/{site}:
    get:
      operationId: jaws_central.analysis.get_site
      tags:
        - site
      summary: Retrieve JAWS-Site info
      description: Return Site parameters
      parameters:
        - name: site
          in: path
          description: JAWS-Site ID
          type: string
          required: True
      responses:
        200:
          description: OK
        401:
          description: Authorization information is missing or invalid.
        404:
          description: The specified record does not exist
        503:
          description: The requested Site is currently unavailable
